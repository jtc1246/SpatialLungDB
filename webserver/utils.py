ALL_GENES = ['AATK', 'ABL1', 'ABL2', 'ACACB', 'ACE', 'ACKR1', 'ACKR3', 'ACKR4', 'ACTA2', 'ACTG2', 'ACVR1', 'ACVR1B', 'ACVR2A', 'ACVRL1', 'ADGRA2', 'ADGRA3', 'ADGRE2', 'ADGRE5', 'ADGRF1', 'ADGRF3', 'ADGRF5', 'ADGRG1', 'ADGRG3', 'ADGRG5', 'ADGRG6', 'ADGRL1', 'ADGRL2', 'ADGRL4', 'ADGRV1', 'ADIPOQ', 'ADIRF', 'ADM2', 'AGER', 'AGR2', 'AHI1', 'AHR', 'AIF1', 'AKT1', 'ALCAM', 'ANGPT1', 'ANGPT2', 'ANGPTL1', 'ANKRD1', 'ANXA1', 'ANXA2', 'ANXA4', 'APOA1', 'APOC1', 'APOD', 'APOE', 'APP', 'AQP3', 'AR', 'AREG', 'ARF1', 'ARG1', 'ARHGDIB', 'ARID5B', 'ATF3', 'ATG10', 'ATG12', 'ATG5', 'ATM', 'ATP5F1E', 'ATR', 'AXL', 'AZGP1', 'AZU1', 'B2M', 'B3GNT7', 'BAG3', 'BAX', 'BBLN', 'BCL2', 'BCL2L1', 'BECN1', 'BEST1', 'BGN', 'BID', 'BIRC5', 'BMP1', 'BMP2', 'BMP3', 'BMP4', 'BMP5', 'BMP7', 'BMPR1A', 'BMPR2', 'BRCA1', 'BST1', 'BST2', 'BTF3', 'BTG1', 'BTK', 'C11orf96', 'C1QA', 'C1QB', 'C1QC', 'C5AR2', 'CACNA1C', 'CALB1', 'CALD1', 'CALM1', 'CALM2', 'CALM3', 'CAMP', 'CARMN', 'CASP3', 'CASP8', 'CASR', 'CAV1', 'CCL11', 'CCL13', 'CCL15', 'CCL18', 'CCL19', 'CCL2', 'CCL20', 'CCL21', 'CCL26', 'CCL28', 'CCL3/L1/L3', 'CCL4/L1/L2', 'CCL5', 'CCL8', 'CCND1', 'CCR1', 'CCR10', 'CCR2', 'CCR5', 'CCR7', 'CCRL2', 'CD14', 'CD163', 'CD164', 'CD19', 'CD2', 'CD209', 'CD24', 'CD27', 'CD274', 'CD276', 'CD28', 'CD300A', 'CD33', 'CD34', 'CD36', 'CD37', 'CD38', 'CD3D', 'CD3E', 'CD3G', 'CD4', 'CD40', 'CD40LG', 'CD44', 'CD47', 'CD48', 'CD52', 'CD53', 'CD55', 'CD58', 'CD59', 'CD5L', 'CD63', 'CD68', 'CD69', 'CD70', 'CD74', 'CD79A', 'CD80', 'CD81', 'CD83', 'CD84', 'CD86', 'CD8A', 'CD8B', 'CD9', 'CDH1', 'CDH11', 'CDH19', 'CDH5', 'CDKN1A', 'CDKN3', 'CEACAM1', 'CEACAM6', 'CELSR1', 'CELSR2', 'CENPF', 'CFD', 'CFLAR', 'CHEK1', 'CHEK2', 'CHI3L1', 'CIDEA', 'CIITA', 'CLCF1', 'CLDN4', 'CLEC10A', 'CLEC12A', 'CLEC14A', 'CLEC1A', 'CLEC2B', 'CLEC2D', 'CLEC4A', 'CLEC4D', 'CLEC4E', 'CLEC5A', 'CLEC7A', 'CLOCK', 'CLU', 'CMKLR1', 'CNTFR', 'COL11A1', 'COL12A1', 'COL14A1', 'COL15A1', 'COL16A1', 'COL17A1', 'COL18A1', 'COL1A1', 'COL1A2', 'COL21A1', 'COL27A1', 'COL3A1', 'COL4A1', 'COL4A2', 'COL4A5', 'COL5A1', 'COL5A2', 'COL5A3', 'COL6A1', 'COL6A2', 'COL6A3', 'COL8A1', 'COL9A2', 'COL9A3', 'COTL1', 'CPA3', 'CPB1', 'CRIP1', 'CRP', 'CRYAB', 'CSF1', 'CSF1R', 'CSF2', 'CSF2RA', 'CSF2RB', 'CSF3', 'CSF3R', 'CSHL1', 'CSK', 'CST7', 'CTLA4', 'CTNNB1', 'CTSG', 'CTSW', 'CUZD1', 'CX3CL1', 'CX3CR1', 'CXCL1/2/3', 'CXCL10', 'CXCL12', 'CXCL14', 'CXCL16', 'CXCL17', 'CXCL5', 'CXCL8', 'CXCL9', 'CXCR1', 'CXCR2', 'CXCR3', 'CXCR4', 'CXCR5', 'CXCR6', 'CYP1B1', 'CYP2U1', 'CYSTM1', 'CYTOR', 'DCN', 'DDC', 'DDIT3', 'DDR1', 'DDR2', 'DDX58', 'DHRS2', 'DLL1', 'DLL4', 'DMBT1', 'DNMT1', 'DNMT3A', 'DPP4', 'DST', 'DUSP1', 'DUSP2', 'DUSP4', 'DUSP5', 'DUSP6', 'EFNA1', 'EFNA4', 'EFNA5', 'EFNB1', 'EFNB2', 'EGF', 'EGFR', 'EIF5A/L1', 'ELANE', 'EMP3', 'ENG', 'ENO1', 'ENTPD1', 'EOMES', 'EPCAM', 'EPHA2', 'EPHA3', 'EPHA4', 'EPHA7', 'EPHB2', 'EPHB3', 'EPHB4', 'EPHB6', 'EPOR', 'ERBB2', 'ERBB3', 'ESAM', 'ESR1', 'ETS1', 'ETV4', 'ETV5', 'EZH2', 'EZR', 'FABP4', 'FABP5', 'FAM30A', 'FAS', 'FASLG', 'FASN', 'FAU', 'FCER1G', 'FCGBP', 'FCGR3A/B', 'FCRLA', 'FES', 'FFAR2', 'FFAR3', 'FFAR4', 'FGF1', 'FGF12', 'FGF13', 'FGF18', 'FGF2', 'FGF7', 'FGF9', 'FGFR1', 'FGFR2', 'FGFR3', 'FGG', 'FGR', 'FHIT', 'FKBP11', 'FKBP5', 'FLT1', 'FLT3LG', 'FN1', 'FOS', 'FOXF1', 'FOXP3', 'FPR1', 'FYB1', 'FYN', 'FZD1', 'FZD3', 'FZD4', 'FZD5', 'FZD6', 'FZD7', 'FZD8', 'G6PD', 'GADD45B', 'GAS6', 'GATA3', 'GC', 'GCG', 'GDF15', 'GLUD1', 'GLUL', 'GNLY', 'GPBAR1', 'GPER1', 'GPNMB', 'GPR183', 'GPX1', 'GPX3', 'GSN', 'GSTP1', 'GZMA', 'GZMB', 'GZMH', 'GZMK', 'H2AZ1', 'H4C3', 'HAVCR2', 'HBA1/2', 'HBB', 'HCAR2/3', 'HCK', 'HCST', 'HDAC1', 'HDAC11', 'HDAC3', 'HDAC4', 'HDAC5', 'HEY1', 'HGF', 'HIF1A', 'HILPDA', 'HLA-DPA1', 'HLA-DPB1', 'HLA-DQA1', 'HLA-DQB1/2', 'HLA-DRA', 'HLA-DRB', 'HMGB2', 'HMGN2', 'HPGDS', 'HSD17B2', 'HSP90AA1', 'HSP90AB1', 'HSP90B1', 'HSPA1A/B', 'HSPB1', 'HTT', 'IAPP', 'ICA1', 'ICAM1', 'ICAM2', 'ICAM3', 'ICOS', 'ICOSLG', 'IDO1', 'IER3', 'IFI27', 'IFI44L', 'IFIH1', 'IFIT1', 'IFIT3', 'IFITM1', 'IFITM3', 'IFNA1/13', 'IFNAR1', 'IFNAR2', 'IFNG', 'IFNGR1', 'IFNGR2', 'IFNL2/3', 'IGF1', 'IGF1R', 'IGF2', 'IGF2R', 'IGFBP3', 'IGFBP5', 'IGFBP6', 'IGFBP7', 'IGHA1', 'IGHD', 'IGHG1', 'IGHG2', 'IGHM', 'IGKC', 'IKZF3', 'IL10', 'IL10RA', 'IL10RB', 'IL11', 'IL11RA', 'IL12A', 'IL12B', 'IL12RB1', 'IL12RB2', 'IL13RA1', 'IL15', 'IL15RA', 'IL16', 'IL17A', 'IL17B', 'IL17D', 'IL17RA', 'IL17RB', 'IL17RE', 'IL18', 'IL18R1', 'IL1A', 'IL1B', 'IL1R1', 'IL1R2', 'IL1RAP', 'IL1RL1', 'IL1RN', 'IL2', 'IL20', 'IL20RA', 'IL22RA1', 'IL23A', 'IL24', 'IL27RA', 'IL2RA', 'IL2RB', 'IL2RG', 'IL32', 'IL33', 'IL34', 'IL36G', 'IL3RA', 'IL4R', 'IL6', 'IL6R', 'IL6ST', 'IL7', 'IL7R', 'INHA', 'INHBA', 'INHBB', 'INS', 'INSR', 'IRF3', 'IRF4', 'ITGA1', 'ITGA2', 'ITGA3', 'ITGA5', 'ITGA6', 'ITGA8', 'ITGA9', 'ITGAE', 'ITGAL', 'ITGAM', 'ITGAV', 'ITGAX', 'ITGB1', 'ITGB2', 'ITGB4', 'ITGB5', 'ITGB6', 'ITGB8', 'ITK', 'ITM2A', 'JAG1', 'JAK1', 'JAK2', 'JCHAIN', 'JUN', 'JUNB', 'KDR', 'KIT', 'KITLG', 'KLF2', 'KLK3', 'KLRB1', 'KLRF1', 'KLRK1', 'KRAS', 'KRT1', 'KRT10', 'KRT13', 'KRT14', 'KRT15', 'KRT16', 'KRT17', 'KRT18', 'KRT19', 'KRT20', 'KRT23', 'KRT4', 'KRT5', 'KRT6A/B/C', 'KRT7', 'KRT8', 'KRT80', 'KRT86', 'LAG3', 'LAIR1', 'LAMP2', 'LAMP3', 'LCN2', 'LDB2', 'LDHA', 'LDLR', 'LEFTY1', 'LEP', 'LGALS1', 'LGALS3', 'LGALS3BP', 'LGALS9', 'LGR5', 'LIF', 'LIFR', 'LINC01781', 'LINC01857', 'LINC02446', 'LMNA', 'LMNB1', 'LPAR5', 'LTB', 'LTBR', 'LTF', 'LUM', 'LY6D', 'LY75', 'LYN', 'LYZ', 'MAF', 'MALAT1', 'MAML2', 'MAP1LC3B/2', 'MAPK13', 'MAPK14', 'MARCO', 'MB', 'MECOM', 'MEG3', 'MERTK', 'MET', 'MFAP5', 'MGP', 'MHC I', 'MIF', 'MIR4435-2HG', 'MKI67', 'MMP1', 'MMP12', 'MMP14', 'MMP19', 'MMP2', 'MMP7', 'MMP9', 'MPO', 'MRC1', 'MRC2', 'MS4A1', 'MS4A4A', 'MS4A6A', 'MSMB', 'MSR1', 'MST1R', 'MT1X', 'MT2A', 'MTOR', 'MUC5AC', 'MX1', 'MXRA8', 'MYC', 'MYH11', 'MYH6', 'MYL12A', 'MYL4', 'MYL7', 'MYL9', 'MZB1', 'MZT2A/B', 'NACA', 'NANOG', 'NCR1', 'NDRG1', 'NEAT1', 'NELL2', 'NFKB1', 'NFKBIA', 'NGFR', 'NKG7', 'NLRC4', 'NLRC5', 'NLRP1', 'NLRP2', 'NLRP3', 'NOD2', 'NOSIP', 'NOTCH1', 'NOTCH2', 'NOTCH3', 'NPPC', 'NPR1', 'NPR2', 'NPR3', 'NR1H2', 'NR1H3', 'NR3C1', 'NRG1', 'NRXN1', 'NRXN3', 'NTRK2', 'NUSAP1', 'OAS1', 'OAS2', 'OAS3', 'OASL', 'OLFM4', 'OLR1', 'OSM', 'OSMR', 'P2RX5', 'PARP1', 'PCNA', 'PDCD1', 'PDCD1LG2', 'PDGFA', 'PDGFB', 'PDGFC', 'PDGFD', 'PDGFRA', 'PDGFRB', 'PDS5A', 'PECAM1', 'PF4/V1', 'PFN1', 'PGF', 'PGR', 'PHLDA2', 'PIGR', 'PLAC8', 'PLAC9', 'PNOC', 'POU5F1', 'PPARA', 'PPARD', 'PPARG', 'PPIA', 'PRF1', 'PRSS2', 'PRTN3', 'PSAP', 'PSCA', 'PSD3', 'PTGDR2', 'PTGDS', 'PTGES', 'PTGES2', 'PTGES3', 'PTGIS', 'PTGS1', 'PTGS2', 'PTK2', 'PTK6', 'PTPRC', 'PTPRCAP', 'PTTG1', 'QRFPR', 'RAC1', 'RAC2', 'RACK1', 'RAG1', 'RAMP1', 'RAMP2', 'RAMP3', 'RARA', 'RARB', 'RARG', 'RARRES1', 'RARRES2', 'RB1', 'RBM47', 'RBPJ', 'REG1A', 'RELA', 'RELT', 'RGCC', 'RGS1', 'RGS2', 'RGS5', 'RNF43', 'ROR1', 'RORA', 'RPL21', 'RPL22', 'RPL32', 'RPL34', 'RPL37', 'RPS4Y1', 'RSPO3', 'RUNX3', 'RXRA', 'RXRB', 'RYK', 'RYR2', 'S100A10', 'S100A2', 'S100A4', 'S100A6', 'S100A8', 'S100A9', 'S100B', 'S100P', 'SAA1/2', 'SARS-COV-2 N', 'SAT1', 'SCG5', 'SCGB3A1', 'SEC23A', 'SEC61G', 'SELENOP', 'SELL', 'SELPLG', 'SERPINA1', 'SERPINA3', 'SERPINB5', 'SERPINH1', 'SFN', 'SFTPB', 'SFTPC', 'SH3BGRL3', 'SIGIRR', 'SLC2A1', 'SLC40A1', 'SLPI', 'SMAD2', 'SMAD3', 'SMAD4', 'SMARCB1', 'SMO', 'SNAI1', 'SNAI2', 'SOD1', 'SOD2', 'SORBS1', 'SOSTDC1', 'SOX2', 'SOX4', 'SOX9', 'SPARCL1', 'SPINK1', 'SPOCK2', 'SPP1', 'SPRY2', 'SPRY4', 'SQSTM1', 'SRC', 'SREBF1', 'SRGN', 'SST', 'ST6GAL1', 'ST6GALNAC3', 'STAT1', 'STAT3', 'STAT4', 'STAT5A', 'STAT5B', 'STAT6', 'STMN1', 'SYK', 'TACSTD2', 'TAGLN', 'TAP1', 'TAP2', 'TBX21', 'TCAP', 'TCF7', 'TCL1A', 'TEK', 'TFEB', 'TGFB1', 'TGFB2', 'TGFB3', 'TGFBR1', 'TGFBR2', 'THBS1', 'THBS2', 'THSD4', 'TIE1', 'TIGIT', 'TIMP1', 'TLR1', 'TLR2', 'TLR3', 'TLR4', 'TLR5', 'TLR7', 'TLR8', 'TM4SF1', 'TNF', 'TNFAIP6', 'TNFRSF10A', 'TNFRSF10B', 'TNFRSF10D', 'TNFRSF11A', 'TNFRSF11B', 'TNFRSF12A', 'TNFRSF13B', 'TNFRSF14', 'TNFRSF17', 'TNFRSF18', 'TNFRSF19', 'TNFRSF1A', 'TNFRSF1B', 'TNFRSF21', 'TNFRSF4', 'TNFRSF9', 'TNFSF10', 'TNFSF12', 'TNFSF13B', 'TNFSF14', 'TNFSF15', 'TNFSF4', 'TNFSF8', 'TNFSF9', 'TNNC1', 'TNNT2', 'TNXA/B', 'TOP2A', 'TOX', 'TP53', 'TP53BP1', 'TPM1', 'TPM2', 'TPSAB1/B2', 'TPT1', 'TSC22D1', 'TSHZ2', 'TTN', 'TTR', 'TUBA1A', 'TUBB', 'TUBB4B', 'TWIST1', 'TWIST2', 'TXK', 'TYK2', 'TYMS', 'TYROBP', 'UBA52', 'UBE2C', 'UPK3A', 'VCAM1', 'VCAN', 'VEGFA', 'VEGFB', 'VEGFC', 'VEGFD', 'VHL', 'VIM', 'VPREB3', 'VSIR', 'VTN', 'VWA1', 'VWF', 'WIF1', 'WNT10B', 'WNT11', 'WNT3', 'WNT5A', 'WNT5B', 'WNT7A', 'WNT7B', 'WNT9A', 'XBP1', 'XCL1/2', 'XKR4', 'YBX3', 'YES1', 'ZFP36']

FOV_INFO = {"19_S1": {"condition": "COVID Patient", "patient": "CO01"}, "20_S1": {"condition": "COVID Patient", "patient": "CO01"}, "21_S1": {"condition": "COVID Patient", "patient": "CO01"}, "22_S1": {"condition": "COVID Patient", "patient": "CO01"}, "23_S1": {"condition": "COVID Patient", "patient": "CO01"}, "24_S1": {"condition": "COVID Patient", "patient": "CO01"}, "25_S1": {"condition": "COVID Patient", "patient": "CO01"}, "26_S1": {"condition": "COVID Patient", "patient": "CO01"}, "27_S1": {"condition": "COVID Patient", "patient": "CO01"}, "28_S1": {"condition": "COVID Patient", "patient": "CO01"}, "29_S1": {"condition": "COVID Patient", "patient": "CO01"}, "30_S1": {"condition": "COVID Patient", "patient": "CO01"}, "31_S1": {"condition": "COVID Patient", "patient": "CO01"}, "32_S1": {"condition": "COVID Patient", "patient": "CO01"}, "33_S1": {"condition": "COVID Patient", "patient": "CO01"}, "34_S1": {"condition": "COVID Patient", "patient": "CO01"}, "35_S1": {"condition": "COVID Patient", "patient": "CO01"}, "36_S1": {"condition": "COVID Patient", "patient": "CO01"}, "1_S1": {"condition": "COVID Patient", "patient": "CO03"}, "2_S1": {"condition": "COVID Patient", "patient": "CO03"}, "3_S1": {"condition": "COVID Patient", "patient": "CO03"}, "4_S1": {"condition": "COVID Patient", "patient": "CO03"}, "5_S1": {"condition": "COVID Patient", "patient": "CO03"}, "6_S1": {"condition": "COVID Patient", "patient": "CO03"}, "7_S1": {"condition": "COVID Patient", "patient": "CO03"}, "8_S1": {"condition": "COVID Patient", "patient": "CO03"}, "9_S1": {"condition": "COVID Patient", "patient": "CO03"}, "10_S1": {"condition": "COVID Patient", "patient": "CO03"}, "11_S1": {"condition": "COVID Patient", "patient": "CO03"}, "12_S1": {"condition": "COVID Patient", "patient": "CO03"}, "13_S1": {"condition": "COVID Patient", "patient": "CO03"}, "14_S1": {"condition": "COVID Patient", "patient": "CO03"}, "15_S1": {"condition": "COVID Patient", "patient": "CO03"}, "16_S1": {"condition": "COVID Patient", "patient": "CO03"}, "17_S1": {"condition": "COVID Patient", "patient": "CO03"}, "18_S1": {"condition": "COVID Patient", "patient": "CO03"}, "55_S1": {"condition": "COVID Patient", "patient": "CO05"}, "56_S1": {"condition": "COVID Patient", "patient": "CO05"}, "57_S1": {"condition": "COVID Patient", "patient": "CO05"}, "58_S1": {"condition": "COVID Patient", "patient": "CO05"}, "59_S1": {"condition": "COVID Patient", "patient": "CO05"}, "60_S1": {"condition": "COVID Patient", "patient": "CO05"}, "61_S1": {"condition": "COVID Patient", "patient": "CO05"}, "62_S1": {"condition": "COVID Patient", "patient": "CO05"}, "63_S1": {"condition": "COVID Patient", "patient": "CO05"}, "64_S1": {"condition": "COVID Patient", "patient": "CO05"}, "65_S1": {"condition": "COVID Patient", "patient": "CO05"}, "66_S1": {"condition": "COVID Patient", "patient": "CO05"}, "67_S1": {"condition": "COVID Patient", "patient": "CO05"}, "68_S1": {"condition": "COVID Patient", "patient": "CO05"}, "69_S1": {"condition": "COVID Patient", "patient": "CO05"}, "70_S1": {"condition": "COVID Patient", "patient": "CO05"}, "71_S1": {"condition": "COVID Patient", "patient": "CO05"}, "72_S1": {"condition": "COVID Patient", "patient": "CO05"}, "73_S1": {"condition": "COVID Patient", "patient": "CO02"}, "74_S1": {"condition": "COVID Patient", "patient": "CO02"}, "75_S1": {"condition": "COVID Patient", "patient": "CO02"}, "76_S1": {"condition": "COVID Patient", "patient": "CO02"}, "77_S1": {"condition": "COVID Patient", "patient": "CO02"}, "78_S1": {"condition": "COVID Patient", "patient": "CO02"}, "79_S1": {"condition": "COVID Patient", "patient": "CO02"}, "80_S1": {"condition": "COVID Patient", "patient": "CO02"}, "81_S1": {"condition": "COVID Patient", "patient": "CO02"}, "82_S1": {"condition": "COVID Patient", "patient": "CO02"}, "83_S1": {"condition": "COVID Patient", "patient": "CO02"}, "84_S1": {"condition": "COVID Patient", "patient": "CO02"}, "85_S1": {"condition": "COVID Patient", "patient": "CO02"}, "86_S1": {"condition": "COVID Patient", "patient": "CO02"}, "87_S1": {"condition": "COVID Patient", "patient": "CO02"}, "88_S1": {"condition": "COVID Patient", "patient": "CO02"}, "89_S1": {"condition": "COVID Patient", "patient": "CO02"}, "90_S1": {"condition": "COVID Patient", "patient": "CO02"}, "55_S2": {"condition": "COVID Patient", "patient": "CO07"}, "56_S2": {"condition": "COVID Patient", "patient": "CO07"}, "57_S2": {"condition": "COVID Patient", "patient": "CO07"}, "58_S2": {"condition": "COVID Patient", "patient": "CO07"}, "59_S2": {"condition": "COVID Patient", "patient": "CO07"}, "60_S2": {"condition": "COVID Patient", "patient": "CO07"}, "61_S2": {"condition": "COVID Patient", "patient": "CO07"}, "62_S2": {"condition": "COVID Patient", "patient": "CO07"}, "63_S2": {"condition": "COVID Patient", "patient": "CO07"}, "64_S2": {"condition": "COVID Patient", "patient": "CO07"}, "65_S2": {"condition": "COVID Patient", "patient": "CO07"}, "66_S2": {"condition": "COVID Patient", "patient": "CO07"}, "67_S2": {"condition": "COVID Patient", "patient": "CO07"}, "68_S2": {"condition": "COVID Patient", "patient": "CO07"}, "69_S2": {"condition": "COVID Patient", "patient": "CO07"}, "70_S2": {"condition": "COVID Patient", "patient": "CO07"}, "71_S2": {"condition": "COVID Patient", "patient": "CO07"}, "72_S2": {"condition": "COVID Patient", "patient": "CO07"}, "109_S2": {"condition": "COVID Patient", "patient": "CO07"}, "110_S2": {"condition": "COVID Patient", "patient": "CO07"}, "111_S2": {"condition": "COVID Patient", "patient": "CO07"}, "112_S2": {"condition": "COVID Patient", "patient": "CO07"}, "91_S2": {"condition": "COVID Patient", "patient": "CO12"}, "92_S2": {"condition": "COVID Patient", "patient": "CO12"}, "93_S2": {"condition": "COVID Patient", "patient": "CO12"}, "94_S2": {"condition": "COVID Patient", "patient": "CO12"}, "95_S2": {"condition": "COVID Patient", "patient": "CO12"}, "96_S2": {"condition": "COVID Patient", "patient": "CO12"}, "97_S2": {"condition": "COVID Patient", "patient": "CO12"}, "98_S2": {"condition": "COVID Patient", "patient": "CO12"}, "99_S2": {"condition": "COVID Patient", "patient": "CO12"}, "100_S2": {"condition": "COVID Patient", "patient": "CO12"}, "101_S2": {"condition": "COVID Patient", "patient": "CO12"}, "102_S2": {"condition": "COVID Patient", "patient": "CO12"}, "103_S2": {"condition": "COVID Patient", "patient": "CO12"}, "104_S2": {"condition": "COVID Patient", "patient": "CO12"}, "105_S2": {"condition": "COVID Patient", "patient": "CO12"}, "106_S2": {"condition": "COVID Patient", "patient": "CO12"}, "107_S2": {"condition": "COVID Patient", "patient": "CO12"}, "108_S2": {"condition": "COVID Patient", "patient": "CO12"}, "1_S3": {"condition": "COVID Patient", "patient": "CO19"}, "2_S3": {"condition": "COVID Patient", "patient": "CO19"}, "3_S3": {"condition": "COVID Patient", "patient": "CO19"}, "4_S3": {"condition": "COVID Patient", "patient": "CO19"}, "5_S3": {"condition": "COVID Patient", "patient": "CO19"}, "6_S3": {"condition": "COVID Patient", "patient": "CO19"}, "7_S3": {"condition": "COVID Patient", "patient": "CO19"}, "8_S3": {"condition": "COVID Patient", "patient": "CO19"}, "9_S3": {"condition": "COVID Patient", "patient": "CO19"}, "10_S3": {"condition": "COVID Patient", "patient": "CO19"}, "11_S3": {"condition": "COVID Patient", "patient": "CO19"}, "12_S3": {"condition": "COVID Patient", "patient": "CO19"}, "13_S3": {"condition": "COVID Patient", "patient": "CO19"}, "14_S3": {"condition": "COVID Patient", "patient": "CO19"}, "15_S3": {"condition": "COVID Patient", "patient": "CO19"}, "16_S3": {"condition": "COVID Patient", "patient": "CO19"}, "17_S3": {"condition": "COVID Patient", "patient": "CO19"}, "18_S3": {"condition": "COVID Patient", "patient": "CO19"}, "103_S3": {"condition": "COVID Patient", "patient": "CO19"}, "104_S3": {"condition": "COVID Patient", "patient": "CO19"}, "105_S3": {"condition": "COVID Patient", "patient": "CO19"}, "106_S3": {"condition": "COVID Patient", "patient": "CO19"}, "107_S3": {"condition": "COVID Patient", "patient": "CO19"}, "108_S3": {"condition": "COVID Patient", "patient": "CO19"}, "67_S3": {"condition": "COVID Patient", "patient": "CO16"}, "68_S3": {"condition": "COVID Patient", "patient": "CO16"}, "69_S3": {"condition": "COVID Patient", "patient": "CO16"}, "70_S3": {"condition": "COVID Patient", "patient": "CO16"}, "71_S3": {"condition": "COVID Patient", "patient": "CO16"}, "72_S3": {"condition": "COVID Patient", "patient": "CO16"}, "73_S3": {"condition": "COVID Patient", "patient": "CO16"}, "74_S3": {"condition": "COVID Patient", "patient": "CO16"}, "75_S3": {"condition": "COVID Patient", "patient": "CO16"}, "76_S3": {"condition": "COVID Patient", "patient": "CO16"}, "77_S3": {"condition": "COVID Patient", "patient": "CO16"}, "78_S3": {"condition": "COVID Patient", "patient": "CO16"}, "79_S3": {"condition": "COVID Patient", "patient": "CO16"}, "80_S3": {"condition": "COVID Patient", "patient": "CO16"}, "81_S3": {"condition": "COVID Patient", "patient": "CO16"}, "82_S3": {"condition": "COVID Patient", "patient": "CO16"}, "83_S3": {"condition": "COVID Patient", "patient": "CO16"}, "84_S3": {"condition": "COVID Patient", "patient": "CO16"}, "1_S4": {"condition": "COVID Patient", "patient": "CO20"}, "2_S4": {"condition": "COVID Patient", "patient": "CO20"}, "3_S4": {"condition": "COVID Patient", "patient": "CO20"}, "4_S4": {"condition": "COVID Patient", "patient": "CO20"}, "5_S4": {"condition": "COVID Patient", "patient": "CO20"}, "6_S4": {"condition": "COVID Patient", "patient": "CO20"}, "7_S4": {"condition": "COVID Patient", "patient": "CO20"}, "8_S4": {"condition": "COVID Patient", "patient": "CO20"}, "9_S4": {"condition": "COVID Patient", "patient": "CO20"}, "10_S4": {"condition": "COVID Patient", "patient": "CO20"}, "11_S4": {"condition": "COVID Patient", "patient": "CO20"}, "12_S4": {"condition": "COVID Patient", "patient": "CO20"}, "13_S4": {"condition": "COVID Patient", "patient": "CO20"}, "14_S4": {"condition": "COVID Patient", "patient": "CO20"}, "15_S4": {"condition": "COVID Patient", "patient": "CO20"}, "16_S4": {"condition": "COVID Patient", "patient": "CO20"}, "17_S4": {"condition": "COVID Patient", "patient": "CO20"}, "18_S4": {"condition": "COVID Patient", "patient": "CO20"}, "55_S4": {"condition": "COVID Patient", "patient": "CO21"}, "56_S4": {"condition": "COVID Patient", "patient": "CO21"}, "57_S4": {"condition": "COVID Patient", "patient": "CO21"}, "58_S4": {"condition": "COVID Patient", "patient": "CO21"}, "59_S4": {"condition": "COVID Patient", "patient": "CO21"}, "60_S4": {"condition": "COVID Patient", "patient": "CO21"}, "61_S4": {"condition": "COVID Patient", "patient": "CO21"}, "62_S4": {"condition": "COVID Patient", "patient": "CO21"}, "63_S4": {"condition": "COVID Patient", "patient": "CO21"}, "64_S4": {"condition": "COVID Patient", "patient": "CO21"}, "65_S4": {"condition": "COVID Patient", "patient": "CO21"}, "66_S4": {"condition": "COVID Patient", "patient": "CO21"}, "67_S4": {"condition": "COVID Patient", "patient": "CO21"}, "68_S4": {"condition": "COVID Patient", "patient": "CO21"}, "69_S4": {"condition": "COVID Patient", "patient": "CO21"}, "70_S4": {"condition": "COVID Patient", "patient": "CO21"}, "71_S4": {"condition": "COVID Patient", "patient": "CO21"}, "72_S4": {"condition": "COVID Patient", "patient": "CO21"}, "91_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "92_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "93_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "94_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "95_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "96_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "97_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "98_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "99_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "100_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "101_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "102_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "103_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "104_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "105_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "106_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "107_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "108_S1": {"condition": "COVID Explant Patient", "patient": "COE01"}, "37_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "38_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "39_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "40_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "41_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "42_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "43_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "44_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "45_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "46_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "47_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "48_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "49_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "50_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "51_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "52_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "53_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "54_S2": {"condition": "COVID Explant Patient", "patient": "COE04"}, "73_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "74_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "75_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "76_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "77_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "78_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "79_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "80_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "81_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "82_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "83_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "84_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "85_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "86_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "87_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "88_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "89_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "90_S2": {"condition": "COVID Explant Patient", "patient": "COE02"}, "19_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "20_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "21_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "22_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "23_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "24_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "25_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "26_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "27_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "28_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "29_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "30_S3": {"condition": "COVID Explant Patient", "patient": "COE06"}, "85_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "86_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "87_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "88_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "89_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "90_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "91_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "92_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "93_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "94_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "95_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "96_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "97_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "98_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "99_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "100_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "101_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "102_S3": {"condition": "COVID Explant Patient", "patient": "COE05"}, "37_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "38_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "39_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "40_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "41_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "42_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "43_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "44_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "45_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "46_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "47_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "48_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "49_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "50_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "51_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "52_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "53_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "54_S4": {"condition": "COVID Explant Patient", "patient": "COE07"}, "37_S1": {"condition": "Healthy", "patient": "H02"}, "38_S1": {"condition": "Healthy", "patient": "H02"}, "39_S1": {"condition": "Healthy", "patient": "H02"}, "40_S1": {"condition": "Healthy", "patient": "H02"}, "41_S1": {"condition": "Healthy", "patient": "H02"}, "42_S1": {"condition": "Healthy", "patient": "H02"}, "43_S1": {"condition": "Healthy", "patient": "H02"}, "44_S1": {"condition": "Healthy", "patient": "H02"}, "45_S1": {"condition": "Healthy", "patient": "H02"}, "46_S1": {"condition": "Healthy", "patient": "H02"}, "47_S1": {"condition": "Healthy", "patient": "H02"}, "48_S1": {"condition": "Healthy", "patient": "H02"}, "49_S1": {"condition": "Healthy", "patient": "H02"}, "50_S1": {"condition": "Healthy", "patient": "H02"}, "51_S1": {"condition": "Healthy", "patient": "H02"}, "52_S1": {"condition": "Healthy", "patient": "H02"}, "53_S1": {"condition": "Healthy", "patient": "H02"}, "54_S1": {"condition": "Healthy", "patient": "H02"}, "1_S2": {"condition": "Healthy", "patient": "H05"}, "2_S2": {"condition": "Healthy", "patient": "H05"}, "3_S2": {"condition": "Healthy", "patient": "H05"}, "4_S2": {"condition": "Healthy", "patient": "H05"}, "5_S2": {"condition": "Healthy", "patient": "H05"}, "6_S2": {"condition": "Healthy", "patient": "H05"}, "7_S2": {"condition": "Healthy", "patient": "H05"}, "8_S2": {"condition": "Healthy", "patient": "H05"}, "9_S2": {"condition": "Healthy", "patient": "H05"}, "10_S2": {"condition": "Healthy", "patient": "H05"}, "11_S2": {"condition": "Healthy", "patient": "H05"}, "12_S2": {"condition": "Healthy", "patient": "H05"}, "13_S2": {"condition": "Healthy", "patient": "H05"}, "14_S2": {"condition": "Healthy", "patient": "H05"}, "15_S2": {"condition": "Healthy", "patient": "H05"}, "16_S2": {"condition": "Healthy", "patient": "H05"}, "17_S2": {"condition": "Healthy", "patient": "H05"}, "18_S2": {"condition": "Healthy", "patient": "H05"}, "19_S2": {"condition": "Healthy", "patient": "H03"}, "20_S2": {"condition": "Healthy", "patient": "H03"}, "21_S2": {"condition": "Healthy", "patient": "H03"}, "22_S2": {"condition": "Healthy", "patient": "H03"}, "23_S2": {"condition": "Healthy", "patient": "H03"}, "24_S2": {"condition": "Healthy", "patient": "H03"}, "25_S2": {"condition": "Healthy", "patient": "H03"}, "26_S2": {"condition": "Healthy", "patient": "H03"}, "27_S2": {"condition": "Healthy", "patient": "H03"}, "28_S2": {"condition": "Healthy", "patient": "H03"}, "29_S2": {"condition": "Healthy", "patient": "H03"}, "30_S2": {"condition": "Healthy", "patient": "H03"}, "31_S2": {"condition": "Healthy", "patient": "H03"}, "32_S2": {"condition": "Healthy", "patient": "H03"}, "33_S2": {"condition": "Healthy", "patient": "H03"}, "34_S2": {"condition": "Healthy", "patient": "H03"}, "35_S2": {"condition": "Healthy", "patient": "H03"}, "36_S2": {"condition": "Healthy", "patient": "H03"}, "31_S3": {"condition": "Healthy", "patient": "H08"}, "32_S3": {"condition": "Healthy", "patient": "H08"}, "33_S3": {"condition": "Healthy", "patient": "H08"}, "34_S3": {"condition": "Healthy", "patient": "H08"}, "35_S3": {"condition": "Healthy", "patient": "H08"}, "36_S3": {"condition": "Healthy", "patient": "H08"}, "37_S3": {"condition": "Healthy", "patient": "H08"}, "38_S3": {"condition": "Healthy", "patient": "H08"}, "39_S3": {"condition": "Healthy", "patient": "H08"}, "40_S3": {"condition": "Healthy", "patient": "H08"}, "41_S3": {"condition": "Healthy", "patient": "H08"}, "42_S3": {"condition": "Healthy", "patient": "H08"}, "43_S3": {"condition": "Healthy", "patient": "H08"}, "44_S3": {"condition": "Healthy", "patient": "H08"}, "45_S3": {"condition": "Healthy", "patient": "H08"}, "46_S3": {"condition": "Healthy", "patient": "H08"}, "47_S3": {"condition": "Healthy", "patient": "H08"}, "48_S3": {"condition": "Healthy", "patient": "H08"}, "49_S3": {"condition": "Healthy", "patient": "H09"}, "50_S3": {"condition": "Healthy", "patient": "H09"}, "51_S3": {"condition": "Healthy", "patient": "H09"}, "52_S3": {"condition": "Healthy", "patient": "H09"}, "53_S3": {"condition": "Healthy", "patient": "H09"}, "54_S3": {"condition": "Healthy", "patient": "H09"}, "55_S3": {"condition": "Healthy", "patient": "H09"}, "56_S3": {"condition": "Healthy", "patient": "H09"}, "57_S3": {"condition": "Healthy", "patient": "H09"}, "58_S3": {"condition": "Healthy", "patient": "H09"}, "59_S3": {"condition": "Healthy", "patient": "H09"}, "60_S3": {"condition": "Healthy", "patient": "H09"}, "61_S3": {"condition": "Healthy", "patient": "H09"}, "62_S3": {"condition": "Healthy", "patient": "H09"}, "63_S3": {"condition": "Healthy", "patient": "H09"}, "64_S3": {"condition": "Healthy", "patient": "H09"}, "65_S3": {"condition": "Healthy", "patient": "H09"}, "66_S3": {"condition": "Healthy", "patient": "H09"}, "19_S4": {"condition": "Healthy", "patient": "H06"}, "20_S4": {"condition": "Healthy", "patient": "H06"}, "21_S4": {"condition": "Healthy", "patient": "H06"}, "22_S4": {"condition": "Healthy", "patient": "H06"}, "23_S4": {"condition": "Healthy", "patient": "H06"}, "24_S4": {"condition": "Healthy", "patient": "H06"}, "25_S4": {"condition": "Healthy", "patient": "H06"}, "26_S4": {"condition": "Healthy", "patient": "H06"}, "27_S4": {"condition": "Healthy", "patient": "H06"}, "28_S4": {"condition": "Healthy", "patient": "H06"}, "29_S4": {"condition": "Healthy", "patient": "H06"}, "30_S4": {"condition": "Healthy", "patient": "H06"}, "31_S4": {"condition": "Healthy", "patient": "H06"}, "32_S4": {"condition": "Healthy", "patient": "H06"}, "33_S4": {"condition": "Healthy", "patient": "H06"}, "34_S4": {"condition": "Healthy", "patient": "H06"}, "35_S4": {"condition": "Healthy", "patient": "H06"}, "36_S4": {"condition": "Healthy", "patient": "H06"}}

CELL_TYPES = ['0:LC-1', '1:Macro', '2:Fibro', '3:SMC', '4:Endo', '5:AT2', '6:Mono', '7:Plasma', '8:RBC', '9:LC-2', '10:AT1', '11:Basal', '12:Nutrophil', '13:Unknown']

from typing import Tuple
import json
import re
from mySecrets import hexToStr
import traceback
import fitz
from R_http import fov_multi
from my_email import send_email


GENES_FORMATTED_TO_ORIGIN = {}

for i in range(0, len(ALL_GENES)):
    this_name = ALL_GENES[i]
    formatted_name = ALL_GENES[i].replace(' ', '').upper()
    GENES_FORMATTED_TO_ORIGIN[formatted_name] = this_name


SAMPLE_FOV_TO_SLIDE = {}

for fov_slide in FOV_INFO:
    fov, slide_num = fov_slide.split('_')
    fov = int(fov)
    slide_num = int(slide_num[1:])
    sample = FOV_INFO[fov_slide]['patient']
    SAMPLE_FOV_TO_SLIDE[(sample, fov)] = slide_num


def convert_input(data: str) -> Tuple[bool, str, Tuple[str, str, int, str, str]]:
    '''
    Convert user input format to R code format
    
    Output: (success, message, (slide, sample, fov, genes, email))
    '''
    try:
        data = hexToStr(data)
        data = json.loads(data)
        sample = data['sample']
        fov = data['fov']
        genes = data['genes']
        email = data['email']
        assert (type(sample) == str)
        assert (type(fov) == str)
        assert (type(genes) == list)
        assert (type(email) == str)
        assert (len(genes) in (2, 3))
        assert (re.match(r'^[a-zA-Z0-9_.+-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z]+$', email))
        fov_num = int(fov)
        assert (str(fov_num) == fov)
        slide_num = SAMPLE_FOV_TO_SLIDE[(sample, fov_num)]
        my_genes = []
        for g in genes:
            assert (type(g) == str)
            assert (g in GENES_FORMATTED_TO_ORIGIN)
            my_genes.append(GENES_FORMATTED_TO_ORIGIN[g])
        if (len(my_genes) == 2):
            assert (my_genes[0] != my_genes[1])
        if (len(my_genes) == 3):
            assert (my_genes[0] != my_genes[1])
            assert (my_genes[1] != my_genes[2])
            assert (my_genes[0] != my_genes[2])
    except Exception as err:
        err_msg = traceback.format_exc()
        return (False, str(err_msg), ())
    slide = f'S7280.{slide_num}'
    sample = sample
    fov_num = fov_num
    my_genes.sort()
    genes = ','.join(my_genes)
    return (True, '', (slide, sample, fov_num, genes, email))
    



def binary_to_str(data: bytes) -> str:
    try:
        return data.decode('utf-8')
    except:
        return str(data)[2:-1]


def pdf_to_png_bytes(pdf_path, dpi=300):
    document = fitz.open(pdf_path)
    if document.page_count > 0:
        page = document.load_page(0)
        zoom = dpi / 72
        mat = fitz.Matrix(zoom, zoom)
        pix = page.get_pixmap(matrix=mat)
        result = pix.tobytes("png")
        # os.remove(pdf_path)
        return result
    
def R_email_pipe(task_id: str, file_name: str, slide: str, sample: str, fov: int, genes: str, email: str, host: str) -> None:
    R_file_name = './tmp/' + file_name
    python_file_name = '../docker/resources/04.exp_functions/tmp/' + file_name
    png_path = '../tmp/' + task_id + '.png'
    file_exist = True
    try:
        f = open(png_path, 'rb')
        _ = f.read()
    except:
        file_exist = False
    if (file_exist):
        f.close()
        resp_msg = 'Success, link is: http://' + host + '/api/generated/' + task_id + '.png'
        resp_msg = f'S{slide[-1]}, {fov}, {sample}, {genes}\n\n' + resp_msg
        title = 'Result for multi-gene FOV image in COVID-Lung CosMX website'
        try:
            send_email(email, title, resp_msg)
            print('Email sent successfully')
        except:
            print('Email sending failed')
        return
    resp = fov_multi(slide, sample, fov, genes, R_file_name)
    resp_msg = ''
    if (resp[0] == False):
        resp_msg = binary_to_str(resp[1])
        resp_msg = "Error: \n" + resp_msg
    else:
        resp_msg = 'Success, link is: http://' + host + '/api/generated/' + task_id + '.png'
        png_bytes = pdf_to_png_bytes(python_file_name)
        with open(png_path, 'wb') as f:
            f.write(png_bytes)
    title = 'Result for multi-gene FOV image in COVID-Lung CosMX website'
    resp_msg = f'S{slide[-1]}, {fov}, {sample}, {genes}\n\n' + resp_msg
    try:
        send_email(email, title, resp_msg)
        print('Email sent successfully')
    except:
        print('Email sending failed')
    

def format_str(text: str) -> str:
    text = text.replace(' ', '').replace('/', '').replace('-', '').replace('.', '')
    return text.lower()

GENES_AI_FORMATTED_TO_ORIGIN = {}
for i in range(0, len(ALL_GENES)):
    this_name = ALL_GENES[i]
    formatted_name = format_str(ALL_GENES[i])
    GENES_AI_FORMATTED_TO_ORIGIN[formatted_name] = this_name


def equals_after_format(str1: str, str2: str) -> bool:
    return (format_str(str1) == format_str(str2))

def find_after_format(list1: list[str], str1: str) -> int:
    for i in range(0, len(list1)):
        if (equals_after_format(list1[i], str1)):
            return i
    return -1

def is_list_str(list1) -> bool:
    if (type(list1) != list):
        return False
    for i in list1:
        if (type(i) != str):
            return False
    return True